<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia Site Renderer 1.7.4 at 2017-10-21 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Camel Demo &#x2013; Usage</title>
    <style type="text/css" media="all">
      @import url("./css/maven-base.css");
      @import url("./css/maven-theme.css");
      @import url("./css/site.css");
    </style>
    <link rel="stylesheet" href="./css/print.css" type="text/css" media="print" />
    <meta http-equiv="Content-Language" content="en" />
        
        </head>
  <body class="composite">
    <div id="banner">
                                      <a href="./" id="bannerLeft">
                                                <img src="Jtech_logo_final.jpg" alt="JTech - Camel Workshop" />
                </a>
                    <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
          
                <div class="xleft">
        <span id="projectVersion">Version: 1.0.0-SNAPSHOT</span>
              </div>
            <div class="xright">                    <a href="https://ordina-jtech.github.io/" class="externalLink" title="Ordina-JTech blog">Ordina-JTech blog</a>
            |
                        <a href="https://www.ordina.nl" class="externalLink" title="Ordina.nl">Ordina.nl</a>
            
                &nbsp;| <span id="publishDate">Last Published: 2017-10-21</span>
            </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
           
                                <h5>Overview</h5>
                  <ul>
                  <li class="none">
                          <a href="index.html" title="Introduction">Introduction</a>
            </li>
                  <li class="none">
                          <a href="install.html" title="install">install</a>
            </li>
                  <li class="none">
            <strong>Usage</strong>
          </li>
                  <li class="none">
                          <a href="build.html" title="Build">Build</a>
            </li>
                  <li class="none">
                          <a href="workshop.html" title="Workshop">Workshop</a>
            </li>
                  <li class="none">
                          <a href="./" title="Source">Source</a>
            </li>
          </ul>
                       <h5>Project Documentation</h5>
                  <ul>
                                                                                                        <li class="collapsed">
                          <a href="project-info.html" title="Project Information">Project Information</a>
                  </li>
                                                                                      <li class="collapsed">
                          <a href="project-reports.html" title="Project Reports">Project Reports</a>
                  </li>
          </ul>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                 
            </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <h1>Usage</h1>
<div class="section">
<h2><a name="Prerequisites"></a>Prerequisites</h2>

<ul>
  
<li>docker (native) installed</li>
  
<li>docker-compose installed</li>
  
<li>java 8 installed</li>
  
<li>maven 3+ installed</li>
  
<li>a sense of adventure :-)</li>
  
<li>a good OS like linux or macOs :-)</li>
</ul></div>
<div class="section">
<h2><a name="Run"></a>Run</h2>
<p>In order to be able to run the demo you first need to start the docker containers from the docker-compose file.</p>
<p>Then you can run application by starting CamelDemoApplication from the IDE or with maven:</p>

<div class="source">
<div class="source">
<pre>docker-compose up -d
mvn clean package spring-boot:run
</pre></div></div></div>
<div class="section">
<h2><a name="What_will_happen"></a>What will happen</h2>
<p>A scenario something like the one below will play out&#x2026; it changes as I add new demo&#x2019;s but you&#x2019;ll get the drift:</p>

<ul>
  
<li>a HelloWorld file is located here: <tt>test-data/startingPoint/HelloWorld.txt</tt></li>
  
<li>this file will be copied by the FileCopyRoute to the <tt>test-data/SimpleJmsRoute</tt> folder</li>
  
<li>The SimpleJmsRoute_1 listens here and routes the file to ActiveMQ Queue SimpleJmsRoute</li>
  
<li>The SimpleJmsRoute_2 listens here and routes the message to the <tt>test-data/ftp/admin</tt> folder and prints the content of the body to console</li>
  
<li>the FtpToFtpRoute will see this because that is the volume &#x201c;mounted&#x201d; by the ftp docker container for the admin user.</li>
  
<li>The FtpToFtpRoute will copy the file to the ftp <tt>user</tt> account through the ftp protocol</li>
  
<li>it will also move the file in the <tt>admin</tt> account to a .camel folder</li>
  
<li>The FtpToFileRoute will see the file in the ftp <tt>user</tt> account and copy it to <tt>target/FtpToFileRoute</tt></li>
  
<li>it will also move the file in the <tt>user</tt> account to .camel in its home folder</li>
  
<li>the log will also print out something like:</li>
</ul>

<div class="source">
<div class="source">
<pre>2017-04-13 22:11:25.048  INFO 5473 --- [/startingPoint/] SimpleFileCopyRoute                      : Found file [HelloWorld.txt] and copying it to: /Users/ivonet/dev/camel-demo/test-data/SimpleJmsRoute/
2017-04-13 22:11:25.192  INFO 5473 --- [SimpleJmsRoute]] nl.ivonet.route.jms.SimpleJmsRoute       : Hello, world!
2017-04-13 22:11:25.666  INFO 5473 --- [localhost:11021] FtpToFtpRoute                            : Found file [HelloWorld.txt] and cp-ing it to the ftp user: user
2017-04-13 22:11:26.169  INFO 5473 --- [localhost:11021] FtpToFileRoute                           : Found file [HelloWorld.txt] and copying it to: /Users/ivonet/dev/camel-demo/target/
</pre></div></div>
<p>The whole idea of the above thing is to play around with routes as to get familiar with it.</p>
<p>The scenario above is outdated because lots more has been implemented but it is a good place to start. Just follow the routes further and you will see it all happening&#x2026;</p>
<h1>docker</h1>
<p>The <tt>docker-compose.yml</tt> file in this project has been tuned to work for this camel-demo project. So some volumes have been mounted with a specific goal.</p></div>
<div class="section">
<h2><a name="Start__Stop_docker-compose"></a>Start / Stop docker-compose</h2>
<p>Start:</p>

<div class="source">
<div class="source">
<pre>docker-compose up [-d]
</pre></div></div>
<p>the -d option will start in daemon mode</p>
<p>Stop:</p>

<div class="source">
<div class="source">
<pre>docker-compose down [-v]
</pre></div></div>
<p>the -v option will also remove the docker volumes created. You can do this any time you want. It might even be preferable in this project as you can then see everything happening from the beginning state.</p>
<h1>FTP docker image</h1>
<p>In order to demo the ftp routes in this project an ftp server has been configured in the docker-compose file. This ftp server mounts &#x2018;native local&#x2019; folders in the <tt>test-data/ftp</tt> folder but it will also actually enable the ftp protocol. So the FtpTo*Routes really talk ftp in the demo.</p>
<p>You will be able to see what happens on your native file system though. Please look at the ftp config in the docker-compose file to see how that works.</p></div>
<div class="section">
<h2><a name="FTP_User"></a>FTP User</h2>
<p>This project has two users pre-configured:</p>

<ul>
  
<li>USER: admin / PWD: secret</li>
  
<li>USER: user / PWD: secret</li>
</ul>
<p>Their home folders reside in <tt>test-data/ftp</tt> and the users have been saved in <tt>docker/ftp/passwd/pureftpd.passwd</tt> file as described below.</p>
<div class="section">
<h3><a name="FTP_Create_your_own_user"></a>FTP Create your own user</h3>
<p>You can add your own user(s) if you want to play:</p>
<p>First you need to start the ivonet/ftp docker container:</p>

<div class="source">
<div class="source">
<pre>docker run --rm --name ftp \
   -v $(pwd)/docker/ftp/passwd:/etc/pure-ftpd/passwd \
   -v $(pwd)/target/ftpusers:/home/ftpusers/ \
   -p 11021:21 \
   -p 30000-30009:30000-30009 \
   ivonet/ftp
</pre></div></div>
<p>Then you need to enter the running image:</p>

<div class="source">
<div class="source">
<pre>docker exec -it ftp /bin/bash
pure-pw useradd USERHERE \
   -f /etc/pure-ftpd/passwd/pureftpd.passwd \
   -m -u ftpuser \
   -d /home/ftpusers/USERHERE
</pre></div></div>
<p>Exit the image with logout and stop the image with ctrl-c or</p>

<div class="source">
<div class="source">
<pre>docker stop ftp
</pre></div></div></div></div>
<div class="section">
<h2><a name="ActiveMQ_docker_image"></a>ActiveMQ docker image</h2>
<p>For this demo ActiveMQ has been chosen as the JMS provider and Message Queue middleware.</p>

<ul>
  
<li><a class="externalLink" href="http://localhost:8161">Console</a> (admin:secret)</li>
  
<li>read more about this image <a class="externalLink" href="https://hub.docker.com/r/ivonet/activemq/">here</a></li>
</ul></div>
<div class="section">
<h2><a name="Mysql_docker_image"></a>Mysql docker image</h2>
<p>To make looking at the results of what happens to to de db <tt>phpmyadmin</tt> has also been included.</p>

<ul>
  
<li><a class="externalLink" href="http://localhost:8888">Console</a> (root:secret)</li>
  
<li>read more about this image <a class="externalLink" href="https://hub.docker.com/r/ivonet/mysql/">here</a></li>
  
<li>this images looks in <tt>docker/mysql/setup</tt> for initializing sql scripts when the first <tt>docker-compose up</tt> is done</li>
</ul></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
              Copyright (c) by Ivo Woltring. All rights reserved
            </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
